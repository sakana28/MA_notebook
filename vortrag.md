首先是motivition。 Wälzlagern是一种重要的机械元件。通过对运行中的Wälzlagern的Vibrationsignale进行分析，可以及时发现潜在的fault。开发实时分析检测的Vibrationsanalysator时需要对其功能进行验证。图中是一种典型的验证setup。使用基于fpga的emulationsplatform可以简化开发过程，这也是本项目的目的。

该emulationsplatform应当满足以下条件：其他硬件可以用和Beschleunigungssensor同样的方式操作它，并读出和sensor同样format的数据。它还应当输出真实或simulated的受损的Wälzlagern的Vibrationsanalysator。

接下来，本文中实现的符合上述要求的emulationsplattform被按照以下顺序介绍。
首先是项目中的任务：本项目中首先Python-Implementierung eines Algorithmus zur Generierung von Vibrationssignalen，然后Entwicklung eines Emulators auf Zynq SoC für die Übertragung von Signalen im Format des Beschleunigungssensors。 Zynq是一种结合了双核ARM prozessor和FPGA的结构，两部分之间通过高性能AXI总线通信。因此，Zynq上的Implementierung包含了FPGA上的硬件设计和ARM中的嵌入式C程序。

Python-Implementierung基于此处提到的论文中提出的算法。该算法可以分别仿真有lokale Punktdefekt和auf der Fläche verteilte Defekte的Wälzlagern的振动。它体现了walzkorper的滑动导致的撞击时间间隔的随机性和旋转时walzkorper的位置的随机性。图中所示的是生成的振动的visualisierung。用户可以添加自己需要的大小的白噪声。

该仿真中有多种参数可以用户自定义，例如•Drehgeschwindigkeit und geometrische Parameter des Wälzlagers
•Schadensstelle: Innenring, Außenring oder Wälzkörper
•Schadentyp: Lokal oder verteilt
•Varianz des zufälligen Teils
•Stärke des Rauschens
•Abtastrate des zeitdiskreten Vibrationssignals usw. 
在开发Vibrationsanalysator时，开发者可以方便地获得大量Reproduzierbar的测试数据，还能根据需要anpassen参数。

接下来介绍了本项目中需要被emuliert的 Beschleunigungssensor, KX134。用户可以通过I2C总线对它的control register进行配置，并从特定的register地址读出加速度数据。Emulator模仿了它在Watermark-interrupt modus的行为。数据被采集后不会立刻被host读出，而会被先储存在Sample buffer中。 当数据量高于Benutzerdefinierte Schwellenwerte时，sensor会产生interrupt信号以通知host读出数据。

本页展示了Zynq上开发系统的流程。它涉及了xilinx提供的开发环境vivado和vitis。接下来Emulationsplatform的系统也会按照先vivado中的硬件设计，再vitis中的软件设计的顺序被介绍。

第一步首先设计了一个可以采集真实加速度信号的signalrekorder. 该系统基于Xilinx官方的AXI-IIC IP核，对KX134进行配置，并读出数据。IIC接口与Interrupt被mapping到Zynq开发板ZC706的GPIO Header上。嵌入式程序读取AXI-IIC接受的数据，对其进行处理后写入SD卡中的文本文件。

然后，模仿KX134功能的Emulator被开发。它可以和KX134一样，通过向特定地址的寄存器写入数据，配置采样率，buffer的阈值并生成interrupt。将存储了作为datenquelle的文本文件的SD卡插到开发板上，文本文件中的数据会被按照KX134的格式被发送到I2C总线上。

最终，将Rekorder和Emulator连接，获得了一个Loopback system。该system中axi-iic作为i2c master, 用VHDL开发的I2C-Slave schnittstelle作为 slave。两者的pin和interrupt信号被mapped到gpio header上。将对应的Pin用kabel连接，即可实现数据的传输。需要注意的是，master和slave这两个模块无法被直接连接。因为I2C的信号线是双向的。而双向数据传输只能在FPGA的pin与pin之间实现，而无法在FPGA内部实现。

该系统的软件完成了以下任务：提供基础的用户交互功能，用户可以通过uart，控制采样的开始时间和signalquelle file。然后对硬件设计中设计的AXI-DMA，AXI-IIC等具有AXI接口的IP进行初始化，配置与控制。这一任务基于Xilinx提供的官方ip在standalone操作系统下的driver实现。对SD卡中signalquelle的读取和将abgetastete signale写入SD卡则基于Xilinx FAT File System Library实现。最后，需要通过数据处理，实现原始加速度数据和KX134的format的加速度数据之间的转换。此处的公式展示了Wertebereich为正负32g，auflösung为16bit时，原始数据和KX134输出的数据之间的关系。

在对Signalrekorder validieren时，在采样时摇晃KX134。SD卡中生成了存储加速度数据的文本文件。对数据进行可视化可以看到晃动的轨迹。对其进行FFT可以看到在5Hz附近有一个峰值。该实验验证了Verifizierung von:
Interrupt-Behandlungssystem
Verbindung zwischen KX134 und FPGA
Konfiguration und Auslesen des KX134
Verarbeitung und Speicherung der Daten

在设计Signalgenerator时，首先没有向Loopback系统中引入AXI数据通路。而是以一个FPGA上实现的counter的结果作为数据。用Logic Analyzer观察总线上的信号，可以看到signalgenerator生成了interrupt信号，并且主机读取0x63，即sample buffer时，signalgenerator输出了正确的数据。

最后，对完整的loopback系统进行了验证。

该系统的hardware overhead很小。仅仅使用了zc706开发板上如下的资源。在更小规模的开发板上如zedboard和zybo上也只使用了5%以下和15%以下的资源。且zynq开发板都具有SD卡槽。说明该项目也可移植到更小规模的开发板上。



