#writing 
![[Signal_generator 2.png]]

本节首先讨论信号生成器系统的预期功能并对功能的实现进行初步设计。
该系统在在信号recorder的基础上去掉了KX134 accelerometer。取而代之的是一个自定义的IP核。该IP核应可与KX134一样通过I2C被配置或被读取数据。ZC706 评估板在 Zynq SoC 的 PL 端和 PS 端都实现了一个 I2C 端口。不过，它们连接到现有的 I2C 总线，以便与固定在板上的 I2C 设备（如 EEPROM）通信。因此，KX134 只能通过 GPIO 接口连接到 Zynq SoC 的 PL 端。

另一方面，记录的信号需要存储起来以便进一步分析和处理，这可以通过 ZC706 板上的 SD 卡插槽方便地完成。因此，加速度数据必须传输到 PS 端才能写入 SD 卡。为此，AXI-IIC IP 核用于 I2C 接口实现以及 PL 和 PS 之间的数据传输。

此外，信号记录器应允许用户在运行时控制采样启动。在 Zynq 嵌入式系统中，应用程序中的 scanf 和 printf 函数默认使用 PS Uart。因此，通过板载 USB-UART 接口和 PC 上的串行设备端口，就能轻松实现从 PC 控制 PS 上运行的程序。

图（）显示了该信号记录器设计的系统框图。KX134 的配置由 PS 中运行的应用程序确定，并通过 AXI4 总线传输到 AXI-IIC IP 核。该 IP 核将配置数据转换为 I2C 信号，并写入 KX134 的特定寄存器。当用户通过 PC 上的串行端口向 PS 输入特定命令时，PS 会通过 AXI-IIC 向 CNTL1 写入控制信号，以激活采样。一旦缓冲器中的采样数量达到阈值，KX134 就会在其 INT1 引脚上产生一个中断。该引脚通过 PL 上的 GPIO 引脚连接到 PS 上的 IRQ_F2P 端口，从而触发 PS 中的中断服务例程以读取加速数据。最后，数据以文本文件的形式存储在 SD 卡中。
